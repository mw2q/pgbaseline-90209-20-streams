BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272320111.929296
 ALGERIA                   |   1997 | 455718163.031548
 ALGERIA                   |   1996 |  464222526.33826
 ALGERIA                   |   1995 | 469115305.994005
 ALGERIA                   |   1994 | 459966650.169507
 ALGERIA                   |   1993 | 456621852.920432
 ALGERIA                   |   1992 | 458591090.734173
 ARGENTINA                 |   1998 | 280201929.812601
 ARGENTINA                 |   1997 | 463064794.822399
 ARGENTINA                 |   1996 | 468463513.618552
 ARGENTINA                 |   1995 | 468660390.654496
 ARGENTINA                 |   1994 | 466691064.596683
 ARGENTINA                 |   1993 | 464693980.510953
 ARGENTINA                 |   1992 | 470199816.142327
 BRAZIL                    |   1998 | 268130830.939629
 BRAZIL                    |   1997 | 465597829.975833
 BRAZIL                    |   1996 | 457760429.729024
 BRAZIL                    |   1995 | 464280964.127121
 BRAZIL                    |   1994 | 450471863.404594
 BRAZIL                    |   1993 | 457656985.942083
 BRAZIL                    |   1992 | 464689924.493012
 CANADA                    |   1998 | 276458992.922784
 CANADA                    |   1997 | 473783814.058022
 CANADA                    |   1996 | 467296599.845089
 CANADA                    |   1995 | 471987170.221424
 CANADA                    |   1994 | 479026164.208594
 CANADA                    |   1993 | 476472369.646449
 CANADA                    |   1992 | 478392984.041852
 CHINA                     |   1998 | 272728304.674284
 CHINA                     |   1997 | 458793837.493663
 CHINA                     |   1996 | 472486805.218039
 CHINA                     |   1995 | 469566558.966313
 CHINA                     |   1994 | 466616622.295325
 CHINA                     |   1993 | 470451568.106928
 CHINA                     |   1992 | 460817077.613663
 EGYPT                     |   1998 |  267916281.20614
 EGYPT                     |   1997 | 462161812.561888
 EGYPT                     |   1996 | 467230650.090045
 EGYPT                     |   1995 | 457199111.276937
 EGYPT                     |   1994 | 448731006.944467
 EGYPT                     |   1993 | 463034415.673104
 EGYPT                     |   1992 |  460075723.72662
 ETHIOPIA                  |   1998 | 273532446.059095
 ETHIOPIA                  |   1997 | 455759927.401954
 ETHIOPIA                  |   1996 | 456571718.877815
 ETHIOPIA                  |   1995 | 450680179.793079
 ETHIOPIA                  |   1994 | 452756197.013727
 ETHIOPIA                  |   1993 |  461669386.68181
 ETHIOPIA                  |   1992 | 459184817.540337
 FRANCE                    |   1998 | 270238625.953545
 FRANCE                    |   1997 | 464826137.856106
 FRANCE                    |   1996 | 467363414.400146
 FRANCE                    |   1995 | 462737496.550894
 FRANCE                    |   1994 |  470337337.62485
 FRANCE                    |   1993 | 464522069.036995
 FRANCE                    |   1992 |  460781876.95999
 GERMANY                   |   1998 | 278189090.306297
 GERMANY                   |   1997 | 474624613.944433
 GERMANY                   |   1996 | 468675560.593201
 GERMANY                   |   1995 | 480773781.347044
 GERMANY                   |   1994 | 473136689.454899
 GERMANY                   |   1993 | 472756338.104737
 GERMANY                   |   1992 | 467783538.409498
 INDIA                     |   1998 | 272708884.420805
 INDIA                     |   1997 | 473549636.572365
 INDIA                     |   1996 | 477141445.573851
 INDIA                     |   1995 |  474247286.58346
 INDIA                     |   1994 |  476961178.06689
 INDIA                     |   1993 | 471059788.168501
 INDIA                     |   1992 | 471513024.131003
 INDONESIA                 |   1998 | 274793893.954507
 INDONESIA                 |   1997 | 461684817.251374
 INDONESIA                 |   1996 | 466409806.145658
 INDONESIA                 |   1995 | 463913033.997848
 INDONESIA                 |   1994 | 459122636.610503
 INDONESIA                 |   1993 | 458231452.227478
 INDONESIA                 |   1992 |  456081261.78912
 IRAN                      |   1998 | 271563937.278023
 IRAN                      |   1997 |  460142654.85149
 IRAN                      |   1996 |  459832096.39461
 IRAN                      |   1995 | 464192637.394419
 IRAN                      |   1994 | 453397295.770805
 IRAN                      |   1993 | 462163953.055603
 IRAN                      |   1992 | 466452941.741205
 IRAQ                      |   1998 | 280276497.629605
 IRAQ                      |   1997 |  465613918.12771
 IRAQ                      |   1996 | 477046893.095591
 IRAQ                      |   1995 | 473646495.650414
 IRAQ                      |   1994 | 477510678.268743
 IRAQ                      |   1993 | 467079073.107857
 IRAQ                      |   1992 | 475640810.713281
 JAPAN                     |   1998 |  262755738.81778
 JAPAN                     |   1997 | 464807013.957588
 JAPAN                     |   1996 | 461310457.500283
 JAPAN                     |   1995 | 458925923.077877
 JAPAN                     |   1994 | 454997218.538997
 JAPAN                     |   1993 |  461758886.02388
 JAPAN                     |   1992 | 460657697.649688
 JORDAN                    |   1998 | 271264703.184011
 JORDAN                    |   1997 |  462348479.08601
 JORDAN                    |   1996 | 460507916.997965
 JORDAN                    |   1995 | 461548390.199005
 JORDAN                    |   1994 | 459431807.711942
 JORDAN                    |   1993 | 472561551.098759
 JORDAN                    |   1992 | 460278710.320021
 KENYA                     |   1998 | 280962677.005347
 KENYA                     |   1997 | 463281115.480565
 KENYA                     |   1996 | 474116667.724002
 KENYA                     |   1995 | 473340512.509898
 KENYA                     |   1994 | 478527826.274598
 KENYA                     |   1993 | 473253148.495158
 KENYA                     |   1992 | 476600179.373425
 MOROCCO                   |   1998 | 272931885.632664
 MOROCCO                   |   1997 | 470954651.718456
 MOROCCO                   |   1996 | 478249199.664441
 MOROCCO                   |   1995 | 471205740.639352
 MOROCCO                   |   1994 | 470656758.080577
 MOROCCO                   |   1993 | 467160583.273944
 MOROCCO                   |   1992 | 469839253.861173
 MOZAMBIQUE                |   1998 | 275449573.229226
 MOZAMBIQUE                |   1997 | 465195667.847867
 MOZAMBIQUE                |   1996 | 474070340.928365
 MOZAMBIQUE                |   1995 | 468129385.779596
 MOZAMBIQUE                |   1994 | 465978568.829157
 MOZAMBIQUE                |   1993 | 466244036.086565
 MOZAMBIQUE                |   1992 | 458410748.219164
 PERU                      |   1998 |  265787242.09444
 PERU                      |   1997 | 457730139.503784
 PERU                      |   1996 |  467623529.68876
 PERU                      |   1995 |  464009284.20882
 PERU                      |   1994 | 459429543.510868
 PERU                      |   1993 | 453630176.781457
 PERU                      |   1992 | 464704068.899923
 ROMANIA                   |   1998 | 279072596.808081
 ROMANIA                   |   1997 | 478903567.655082
 ROMANIA                   |   1996 | 477491555.875112
 ROMANIA                   |   1995 | 467832746.183494
 ROMANIA                   |   1994 | 473500848.107095
 ROMANIA                   |   1993 |  470128642.41319
 ROMANIA                   |   1992 | 470838913.194844
 RUSSIA                    |   1998 | 272986658.846941
 RUSSIA                    |   1997 | 465078785.782688
 RUSSIA                    |   1996 | 465407993.343573
 RUSSIA                    |   1995 | 469384173.048312
 RUSSIA                    |   1994 | 463137331.721753
 RUSSIA                    |   1993 | 464889455.456401
 RUSSIA                    |   1992 | 465120228.769277
 SAUDI ARABIA              |   1998 |  278008637.08758
 SAUDI ARABIA              |   1997 | 468235804.118097
 SAUDI ARABIA              |   1996 | 466240578.535921
 SAUDI ARABIA              |   1995 | 475913669.231978
 SAUDI ARABIA              |   1994 | 468091913.214842
 SAUDI ARABIA              |   1993 | 470611471.018286
 SAUDI ARABIA              |   1992 | 474401166.986802
 UNITED KINGDOM            |   1998 | 269395612.028351
 UNITED KINGDOM            |   1997 | 456328917.563285
 UNITED KINGDOM            |   1996 | 449629511.188733
 UNITED KINGDOM            |   1995 | 458564037.858217
 UNITED KINGDOM            |   1994 | 459512153.671191
 UNITED KINGDOM            |   1993 | 458538910.844974
 UNITED KINGDOM            |   1992 | 446113257.740259
 UNITED STATES             |   1998 | 274281872.839639
 UNITED STATES             |   1997 |  483842508.02277
 UNITED STATES             |   1996 | 480896115.831945
 UNITED STATES             |   1995 | 472832428.282784
 UNITED STATES             |   1994 | 476932586.028916
 UNITED STATES             |   1993 | 476117289.735225
 UNITED STATES             |   1992 | 477799435.314319
 VIETNAM                   |   1998 |  273519850.85334
 VIETNAM                   |   1997 |   467182914.5859
 VIETNAM                   |   1996 | 477150728.137499
 VIETNAM                   |   1995 | 458306686.000172
 VIETNAM                   |   1994 | 465647979.115374
 VIETNAM                   |   1993 | 465258172.592014
 VIETNAM                   |   1992 | 474205923.660974
(175 rows)

COMMIT;
COMMIT
