BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dim%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271012654.937931
 ALGERIA                   |   1997 | 461709437.864542
 ALGERIA                   |   1996 | 467282206.916452
 ALGERIA                   |   1995 | 455894668.293172
 ALGERIA                   |   1994 | 454711767.942426
 ALGERIA                   |   1993 | 460517652.711299
 ALGERIA                   |   1992 |  456398614.56863
 ARGENTINA                 |   1998 | 275117129.641636
 ARGENTINA                 |   1997 | 477490290.055025
 ARGENTINA                 |   1996 | 470170326.847717
 ARGENTINA                 |   1995 | 475027111.373285
 ARGENTINA                 |   1994 | 471056190.858806
 ARGENTINA                 |   1993 | 467400144.794655
 ARGENTINA                 |   1992 | 470412001.636254
 BRAZIL                    |   1998 | 270523352.206673
 BRAZIL                    |   1997 | 461744599.934577
 BRAZIL                    |   1996 | 464017067.016536
 BRAZIL                    |   1995 | 462085286.361665
 BRAZIL                    |   1994 | 459385511.017657
 BRAZIL                    |   1993 | 465729775.550469
 BRAZIL                    |   1992 | 463977656.774128
 CANADA                    |   1998 | 276383950.776018
 CANADA                    |   1997 | 467613368.381288
 CANADA                    |   1996 | 476832488.278816
 CANADA                    |   1995 |  472419358.97615
 CANADA                    |   1994 | 475235629.808487
 CANADA                    |   1993 | 469173512.378133
 CANADA                    |   1992 |  476636828.52667
 CHINA                     |   1998 | 275743626.282293
 CHINA                     |   1997 | 469798050.781537
 CHINA                     |   1996 | 467432158.437848
 CHINA                     |   1995 | 470609320.534328
 CHINA                     |   1994 | 463884999.850594
 CHINA                     |   1993 | 467863079.740151
 CHINA                     |   1992 | 472166789.016049
 EGYPT                     |   1998 | 277487651.221158
 EGYPT                     |   1997 | 473172213.092635
 EGYPT                     |   1996 | 474347425.925015
 EGYPT                     |   1995 | 462639737.147868
 EGYPT                     |   1994 |  466738810.19231
 EGYPT                     |   1993 | 467933233.597373
 EGYPT                     |   1992 | 468375242.659084
 ETHIOPIA                  |   1998 | 266581686.160161
 ETHIOPIA                  |   1997 | 454604085.970907
 ETHIOPIA                  |   1996 | 455390256.990439
 ETHIOPIA                  |   1995 | 455805878.160654
 ETHIOPIA                  |   1994 | 453613585.115302
 ETHIOPIA                  |   1993 | 459019293.107173
 ETHIOPIA                  |   1992 | 462859669.031289
 FRANCE                    |   1998 | 264939858.915042
 FRANCE                    |   1997 | 459845128.698689
 FRANCE                    |   1996 | 454058800.049653
 FRANCE                    |   1995 | 455132740.886918
 FRANCE                    |   1994 | 457314006.554933
 FRANCE                    |   1993 | 457540329.001485
 FRANCE                    |   1992 | 450928931.974861
 GERMANY                   |   1998 | 280530918.476612
 GERMANY                   |   1997 | 474680799.019493
 GERMANY                   |   1996 | 474808515.341221
 GERMANY                   |   1995 | 476022530.160269
 GERMANY                   |   1994 | 478568598.180094
 GERMANY                   |   1993 |  480288544.03234
 GERMANY                   |   1992 | 477107649.864931
 INDIA                     |   1998 | 271766249.917631
 INDIA                     |   1997 | 481537539.109393
 INDIA                     |   1996 | 479415622.775155
 INDIA                     |   1995 | 478308716.956569
 INDIA                     |   1994 | 472343552.462091
 INDIA                     |   1993 | 471600456.754494
 INDIA                     |   1992 |  477658910.40129
 INDONESIA                 |   1998 | 271644467.716321
 INDONESIA                 |   1997 | 464088700.641788
 INDONESIA                 |   1996 |  472614345.47772
 INDONESIA                 |   1995 | 468814139.328429
 INDONESIA                 |   1994 | 460330428.988354
 INDONESIA                 |   1993 | 472753334.052498
 INDONESIA                 |   1992 | 469159863.769705
 IRAN                      |   1998 | 273641837.572239
 IRAN                      |   1997 | 465781521.385746
 IRAN                      |   1996 | 453564543.781603
 IRAN                      |   1995 | 457484978.205302
 IRAN                      |   1994 | 457984170.075491
 IRAN                      |   1993 | 454673140.159427
 IRAN                      |   1992 | 457350075.964189
 IRAQ                      |   1998 | 274445902.703437
 IRAQ                      |   1997 | 474118981.875154
 IRAQ                      |   1996 | 472260894.309038
 IRAQ                      |   1995 | 474074724.232952
 IRAQ                      |   1994 | 472090627.720981
 IRAQ                      |   1993 | 472179425.749437
 IRAQ                      |   1992 | 476371408.110601
 JAPAN                     |   1998 | 269563148.062539
 JAPAN                     |   1997 | 465942748.229512
 JAPAN                     |   1996 | 465651199.349385
 JAPAN                     |   1995 | 468993565.940984
 JAPAN                     |   1994 | 456400175.249072
 JAPAN                     |   1993 | 463737733.307163
 JAPAN                     |   1992 | 460491298.219792
 JORDAN                    |   1998 | 275314365.412902
 JORDAN                    |   1997 | 459875767.538516
 JORDAN                    |   1996 | 458057416.740005
 JORDAN                    |   1995 | 456535835.330474
 JORDAN                    |   1994 | 456438877.471523
 JORDAN                    |   1993 | 456149971.923193
 JORDAN                    |   1992 | 462155146.757996
 KENYA                     |   1998 |    274051148.103
 KENYA                     |   1997 |  467335367.27332
 KENYA                     |   1996 | 472984294.299723
 KENYA                     |   1995 | 465579729.207686
 KENYA                     |   1994 | 467064615.070429
 KENYA                     |   1993 | 473808687.736332
 KENYA                     |   1992 | 473173492.052749
 MOROCCO                   |   1998 | 275842880.653907
 MOROCCO                   |   1997 | 470199094.547055
 MOROCCO                   |   1996 | 464172542.805603
 MOROCCO                   |   1995 | 468701785.396916
 MOROCCO                   |   1994 | 470713188.574206
 MOROCCO                   |   1993 |  463226090.08234
 MOROCCO                   |   1992 | 469044717.478406
 MOZAMBIQUE                |   1998 | 275316084.375448
 MOZAMBIQUE                |   1997 | 469810092.545663
 MOZAMBIQUE                |   1996 | 466811368.596065
 MOZAMBIQUE                |   1995 | 471399599.561281
 MOZAMBIQUE                |   1994 |  459448265.99016
 MOZAMBIQUE                |   1993 | 464029071.712036
 MOZAMBIQUE                |   1992 | 460609418.873499
 PERU                      |   1998 | 275886864.791169
 PERU                      |   1997 | 468576195.471865
 PERU                      |   1996 | 461549492.133654
 PERU                      |   1995 | 459298351.583289
 PERU                      |   1994 | 462687229.369545
 PERU                      |   1993 | 464627185.049765
 PERU                      |   1992 | 468342870.372903
 ROMANIA                   |   1998 | 276889939.483082
 ROMANIA                   |   1997 | 466764241.698605
 ROMANIA                   |   1996 | 473161336.261489
 ROMANIA                   |   1995 | 466662493.952202
 ROMANIA                   |   1994 | 471913266.274915
 ROMANIA                   |   1993 | 471339180.955967
 ROMANIA                   |   1992 | 472060428.236304
 RUSSIA                    |   1998 | 277976807.611724
 RUSSIA                    |   1997 | 472885056.800847
 RUSSIA                    |   1996 | 474693111.704925
 RUSSIA                    |   1995 | 477852173.685502
 RUSSIA                    |   1994 | 473064258.462965
 RUSSIA                    |   1993 | 472400429.985371
 RUSSIA                    |   1992 | 481748412.202117
 SAUDI ARABIA              |   1998 | 270927640.815956
 SAUDI ARABIA              |   1997 | 458265869.093008
 SAUDI ARABIA              |   1996 | 462073089.898043
 SAUDI ARABIA              |   1995 | 462564987.147863
 SAUDI ARABIA              |   1994 | 462335977.217192
 SAUDI ARABIA              |   1993 | 466551015.257051
 SAUDI ARABIA              |   1992 | 474818089.340324
 UNITED KINGDOM            |   1998 | 273291533.486942
 UNITED KINGDOM            |   1997 | 463677167.689738
 UNITED KINGDOM            |   1996 | 463364216.765608
 UNITED KINGDOM            |   1995 | 463293073.159805
 UNITED KINGDOM            |   1994 | 466676837.026154
 UNITED KINGDOM            |   1993 | 461007571.362156
 UNITED KINGDOM            |   1992 | 463522544.881096
 UNITED STATES             |   1998 | 283796059.836069
 UNITED STATES             |   1997 | 474522506.884361
 UNITED STATES             |   1996 | 477460833.277427
 UNITED STATES             |   1995 | 475031227.238597
 UNITED STATES             |   1994 | 475676050.820033
 UNITED STATES             |   1993 | 481185537.736278
 UNITED STATES             |   1992 | 485571703.839115
 VIETNAM                   |   1998 | 274989077.562754
 VIETNAM                   |   1997 | 465033784.824682
 VIETNAM                   |   1996 | 470340291.215546
 VIETNAM                   |   1995 | 466503733.517153
 VIETNAM                   |   1994 | 465830333.810996
 VIETNAM                   |   1993 | 475497062.168363
 VIETNAM                   |   1992 | 465522896.596182
(175 rows)

COMMIT;
COMMIT
