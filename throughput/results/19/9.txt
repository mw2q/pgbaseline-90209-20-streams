BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%slate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 260890196.637423
 ALGERIA                   |   1997 | 449696473.644836
 ALGERIA                   |   1996 | 451236374.458422
 ALGERIA                   |   1995 | 445272557.938977
 ALGERIA                   |   1994 | 455407437.547414
 ALGERIA                   |   1993 | 443590042.768085
 ALGERIA                   |   1992 | 451615942.818247
 ARGENTINA                 |   1998 | 278352611.229623
 ARGENTINA                 |   1997 | 470171126.282537
 ARGENTINA                 |   1996 | 465100293.494604
 ARGENTINA                 |   1995 | 468247172.768399
 ARGENTINA                 |   1994 | 472322152.349985
 ARGENTINA                 |   1993 | 462652243.680044
 ARGENTINA                 |   1992 | 467689067.473582
 BRAZIL                    |   1998 |  276151274.44407
 BRAZIL                    |   1997 | 473662440.893842
 BRAZIL                    |   1996 | 472178932.780762
 BRAZIL                    |   1995 | 469037682.244619
 BRAZIL                    |   1994 | 466289576.562713
 BRAZIL                    |   1993 | 471610223.812054
 BRAZIL                    |   1992 | 476509764.893252
 CANADA                    |   1998 | 272500559.149169
 CANADA                    |   1997 | 468798877.935942
 CANADA                    |   1996 | 468727243.205791
 CANADA                    |   1995 | 474007671.144915
 CANADA                    |   1994 | 481085612.427313
 CANADA                    |   1993 | 477692558.643003
 CANADA                    |   1992 | 470839477.859064
 CHINA                     |   1998 | 275318094.476161
 CHINA                     |   1997 | 464703807.160979
 CHINA                     |   1996 | 473419688.266164
 CHINA                     |   1995 | 464717461.007147
 CHINA                     |   1994 | 465777203.981014
 CHINA                     |   1993 | 470225228.172897
 CHINA                     |   1992 | 467997640.671047
 EGYPT                     |   1998 | 269001843.768141
 EGYPT                     |   1997 | 473101402.761538
 EGYPT                     |   1996 | 466761863.332512
 EGYPT                     |   1995 | 467669185.329067
 EGYPT                     |   1994 | 470902657.362167
 EGYPT                     |   1993 | 468604623.553886
 EGYPT                     |   1992 | 477337455.839739
 ETHIOPIA                  |   1998 | 274624303.694865
 ETHIOPIA                  |   1997 | 455741548.825149
 ETHIOPIA                  |   1996 | 451641067.736409
 ETHIOPIA                  |   1995 | 456301326.057909
 ETHIOPIA                  |   1994 | 461652196.815936
 ETHIOPIA                  |   1993 | 459012087.385807
 ETHIOPIA                  |   1992 | 459373329.997372
 FRANCE                    |   1998 | 268950186.618259
 FRANCE                    |   1997 | 460133399.367952
 FRANCE                    |   1996 |  457592543.60274
 FRANCE                    |   1995 | 461756948.325978
 FRANCE                    |   1994 | 458762960.229891
 FRANCE                    |   1993 | 461975538.855232
 FRANCE                    |   1992 | 453246291.697738
 GERMANY                   |   1998 | 281883033.193556
 GERMANY                   |   1997 | 473152910.830783
 GERMANY                   |   1996 |  477733061.04349
 GERMANY                   |   1995 | 480746272.264721
 GERMANY                   |   1994 | 475262787.841939
 GERMANY                   |   1993 | 471099217.446839
 GERMANY                   |   1992 |    471622338.031
 INDIA                     |   1998 | 267040683.820597
 INDIA                     |   1997 | 462889829.488654
 INDIA                     |   1996 | 478951883.607997
 INDIA                     |   1995 |  477591998.04816
 INDIA                     |   1994 | 465152309.913834
 INDIA                     |   1993 | 469284687.407687
 INDIA                     |   1992 | 466486843.455638
 INDONESIA                 |   1998 | 268290841.236694
 INDONESIA                 |   1997 | 462693087.316618
 INDONESIA                 |   1996 | 473621888.237865
 INDONESIA                 |   1995 | 458305483.941271
 INDONESIA                 |   1994 | 463830588.448023
 INDONESIA                 |   1993 | 462024040.597231
 INDONESIA                 |   1992 | 460373489.115858
 IRAN                      |   1998 | 267400848.068116
 IRAN                      |   1997 | 464848083.829305
 IRAN                      |   1996 | 461933848.440748
 IRAN                      |   1995 | 461762460.712681
 IRAN                      |   1994 | 465537295.349097
 IRAN                      |   1993 | 457990378.454648
 IRAN                      |   1992 | 466693261.977918
 IRAQ                      |   1998 | 280330537.855821
 IRAQ                      |   1997 | 471600098.026412
 IRAQ                      |   1996 | 478792533.030954
 IRAQ                      |   1995 | 470530134.055169
 IRAQ                      |   1994 | 472427719.489742
 IRAQ                      |   1993 | 469487013.414594
 IRAQ                      |   1992 | 476703248.336611
 JAPAN                     |   1998 | 267943274.264604
 JAPAN                     |   1997 | 463877215.975112
 JAPAN                     |   1996 | 470016497.144092
 JAPAN                     |   1995 | 460695568.327263
 JAPAN                     |   1994 |  466771169.86972
 JAPAN                     |   1993 |  463910371.14227
 JAPAN                     |   1992 | 462602727.796707
 JORDAN                    |   1998 | 268893770.962791
 JORDAN                    |   1997 | 449815497.085061
 JORDAN                    |   1996 | 459247712.042179
 JORDAN                    |   1995 | 454772104.683766
 JORDAN                    |   1994 | 456130186.436665
 JORDAN                    |   1993 | 448377454.344669
 JORDAN                    |   1992 | 452894850.030571
 KENYA                     |   1998 | 282218691.684864
 KENYA                     |   1997 | 469463192.594131
 KENYA                     |   1996 | 478711459.603971
 KENYA                     |   1995 | 474307722.647024
 KENYA                     |   1994 | 471571810.995612
 KENYA                     |   1993 | 479604025.713359
 KENYA                     |   1992 | 470183256.435758
 MOROCCO                   |   1998 | 274525625.254496
 MOROCCO                   |   1997 |   459670081.0118
 MOROCCO                   |   1996 | 464854531.116898
 MOROCCO                   |   1995 | 468939268.795023
 MOROCCO                   |   1994 |  463904258.51126
 MOROCCO                   |   1993 | 466035011.130798
 MOROCCO                   |   1992 | 471876795.282356
 MOZAMBIQUE                |   1998 | 267175305.683245
 MOZAMBIQUE                |   1997 | 454871695.477388
 MOZAMBIQUE                |   1996 | 456881131.245849
 MOZAMBIQUE                |   1995 |  455221323.43044
 MOZAMBIQUE                |   1994 | 449837812.494834
 MOZAMBIQUE                |   1993 | 448318199.582141
 MOZAMBIQUE                |   1992 | 455339181.034736
 PERU                      |   1998 |  279323327.74936
 PERU                      |   1997 | 469068454.766752
 PERU                      |   1996 | 467718114.547572
 PERU                      |   1995 | 474895572.191125
 PERU                      |   1994 | 467284737.672353
 PERU                      |   1993 | 471565159.767033
 PERU                      |   1992 | 461331258.737581
 ROMANIA                   |   1998 | 275497893.825844
 ROMANIA                   |   1997 | 460359713.439676
 ROMANIA                   |   1996 | 465721020.201405
 ROMANIA                   |   1995 | 455380168.339494
 ROMANIA                   |   1994 | 460042567.534193
 ROMANIA                   |   1993 | 463780024.014362
 ROMANIA                   |   1992 | 466467792.026869
 RUSSIA                    |   1998 |  275117903.07795
 RUSSIA                    |   1997 | 465726654.808712
 RUSSIA                    |   1996 | 471202687.136715
 RUSSIA                    |   1995 | 463687490.469081
 RUSSIA                    |   1994 | 463235380.214374
 RUSSIA                    |   1993 | 463239590.479686
 RUSSIA                    |   1992 | 466333575.375457
 SAUDI ARABIA              |   1998 | 277435620.141225
 SAUDI ARABIA              |   1997 |  469870196.62773
 SAUDI ARABIA              |   1996 | 464580266.664323
 SAUDI ARABIA              |   1995 |   466179249.0435
 SAUDI ARABIA              |   1994 | 462776598.556003
 SAUDI ARABIA              |   1993 |  467022637.43658
 SAUDI ARABIA              |   1992 | 460907401.553426
 UNITED KINGDOM            |   1998 | 275055717.054343
 UNITED KINGDOM            |   1997 | 470065383.198409
 UNITED KINGDOM            |   1996 | 466810286.118163
 UNITED KINGDOM            |   1995 | 471665918.233754
 UNITED KINGDOM            |   1994 | 473137084.307175
 UNITED KINGDOM            |   1993 | 464104447.991033
 UNITED KINGDOM            |   1992 | 465909323.576198
 UNITED STATES             |   1998 | 274684804.016914
 UNITED STATES             |   1997 | 465104957.621571
 UNITED STATES             |   1996 | 462202422.712556
 UNITED STATES             |   1995 |   469125249.0404
 UNITED STATES             |   1994 | 468819597.907212
 UNITED STATES             |   1993 | 466930409.533504
 UNITED STATES             |   1992 | 465745380.876847
 VIETNAM                   |   1998 |  270924953.14056
 VIETNAM                   |   1997 | 474295007.848519
 VIETNAM                   |   1996 |   466531220.6152
 VIETNAM                   |   1995 | 456077077.276598
 VIETNAM                   |   1994 | 469021846.315557
 VIETNAM                   |   1993 | 472706579.230386
 VIETNAM                   |   1992 | 458249204.285172
(175 rows)

COMMIT;
COMMIT
