BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268297138.071366
 ALGERIA                   |   1997 | 460078982.405764
 ALGERIA                   |   1996 | 465093694.872438
 ALGERIA                   |   1995 |  468365260.12636
 ALGERIA                   |   1994 | 460478849.980663
 ALGERIA                   |   1993 | 466961665.631167
 ALGERIA                   |   1992 | 466471503.417283
 ARGENTINA                 |   1998 | 275017282.521879
 ARGENTINA                 |   1997 | 471012973.144433
 ARGENTINA                 |   1996 | 471104544.253237
 ARGENTINA                 |   1995 | 467379401.341081
 ARGENTINA                 |   1994 | 471411997.026553
 ARGENTINA                 |   1993 | 470144810.311772
 ARGENTINA                 |   1992 | 465832993.550239
 BRAZIL                    |   1998 | 272835609.931557
 BRAZIL                    |   1997 | 460905047.713071
 BRAZIL                    |   1996 | 459843251.865051
 BRAZIL                    |   1995 | 462175368.102738
 BRAZIL                    |   1994 | 464716088.649197
 BRAZIL                    |   1993 | 468042933.487342
 BRAZIL                    |   1992 | 462774422.569322
 CANADA                    |   1998 | 276636845.734809
 CANADA                    |   1997 | 483108779.835754
 CANADA                    |   1996 | 480818375.259512
 CANADA                    |   1995 | 476367328.629047
 CANADA                    |   1994 | 484816136.407098
 CANADA                    |   1993 | 474855302.238198
 CANADA                    |   1992 | 476201018.039475
 CHINA                     |   1998 | 273907712.204343
 CHINA                     |   1997 | 469478985.199891
 CHINA                     |   1996 | 467955907.344957
 CHINA                     |   1995 | 461007951.053789
 CHINA                     |   1994 | 465881604.581261
 CHINA                     |   1993 | 467911339.147529
 CHINA                     |   1992 | 465881857.042341
 EGYPT                     |   1998 | 276993548.037139
 EGYPT                     |   1997 | 465145648.968644
 EGYPT                     |   1996 | 468255663.912973
 EGYPT                     |   1995 | 465007208.779698
 EGYPT                     |   1994 | 463083829.049348
 EGYPT                     |   1993 |  473394471.78104
 EGYPT                     |   1992 |  463825763.87723
 ETHIOPIA                  |   1998 | 270936136.433912
 ETHIOPIA                  |   1997 | 462115709.395808
 ETHIOPIA                  |   1996 | 452413964.451252
 ETHIOPIA                  |   1995 | 458933385.683276
 ETHIOPIA                  |   1994 |  466561066.98126
 ETHIOPIA                  |   1993 | 451513400.233998
 ETHIOPIA                  |   1992 | 470322144.309311
 FRANCE                    |   1998 | 270786072.181203
 FRANCE                    |   1997 | 463441874.238723
 FRANCE                    |   1996 | 467236567.002793
 FRANCE                    |   1995 | 464973251.381095
 FRANCE                    |   1994 |  464777920.97084
 FRANCE                    |   1993 |  469471396.38259
 FRANCE                    |   1992 | 471425336.163466
 GERMANY                   |   1998 | 272398712.910802
 GERMANY                   |   1997 | 465061957.642276
 GERMANY                   |   1996 | 471102838.567438
 GERMANY                   |   1995 | 469872526.287672
 GERMANY                   |   1994 | 466366985.495857
 GERMANY                   |   1993 | 468540556.697882
 GERMANY                   |   1992 | 467871688.275288
 INDIA                     |   1998 | 276648652.142526
 INDIA                     |   1997 | 469147269.380649
 INDIA                     |   1996 | 473345534.238278
 INDIA                     |   1995 | 463133127.781665
 INDIA                     |   1994 | 470301158.588234
 INDIA                     |   1993 | 466963254.666414
 INDIA                     |   1992 | 465314620.929129
 INDONESIA                 |   1998 | 277832135.958841
 INDONESIA                 |   1997 | 467308468.472675
 INDONESIA                 |   1996 | 467267998.855789
 INDONESIA                 |   1995 | 468376431.572024
 INDONESIA                 |   1994 | 464800953.618498
 INDONESIA                 |   1993 | 473285002.276744
 INDONESIA                 |   1992 | 460197703.994552
 IRAN                      |   1998 | 267306875.637201
 IRAN                      |   1997 | 464512678.384682
 IRAN                      |   1996 | 456356992.948586
 IRAN                      |   1995 | 458403813.393378
 IRAN                      |   1994 | 458014433.998087
 IRAN                      |   1993 |  456787079.67224
 IRAN                      |   1992 | 462771347.599487
 IRAQ                      |   1998 | 274472342.090199
 IRAQ                      |   1997 | 472201695.466342
 IRAQ                      |   1996 | 477681950.230388
 IRAQ                      |   1995 | 470402208.474205
 IRAQ                      |   1994 |  468433174.00661
 IRAQ                      |   1993 |  482612726.46402
 IRAQ                      |   1992 | 477491229.211362
 JAPAN                     |   1998 | 269028237.146347
 JAPAN                     |   1997 | 467139774.585032
 JAPAN                     |   1996 | 468781879.139174
 JAPAN                     |   1995 |  468628481.88807
 JAPAN                     |   1994 | 468101619.380804
 JAPAN                     |   1993 | 475789490.061891
 JAPAN                     |   1992 | 472437681.541521
 JORDAN                    |   1998 | 269503671.546749
 JORDAN                    |   1997 | 453828413.241545
 JORDAN                    |   1996 | 456111660.957256
 JORDAN                    |   1995 | 459453071.922083
 JORDAN                    |   1994 | 458171092.464201
 JORDAN                    |   1993 | 456152673.801912
 JORDAN                    |   1992 | 455053853.793062
 KENYA                     |   1998 | 279879920.302305
 KENYA                     |   1997 | 480265380.303688
 KENYA                     |   1996 | 480714335.877133
 KENYA                     |   1995 | 471386580.785371
 KENYA                     |   1994 | 468357488.041488
 KENYA                     |   1993 | 472656079.977211
 KENYA                     |   1992 | 469761170.575164
 MOROCCO                   |   1998 | 274305818.043697
 MOROCCO                   |   1997 | 474827952.876211
 MOROCCO                   |   1996 | 468757983.278679
 MOROCCO                   |   1995 | 471675111.674841
 MOROCCO                   |   1994 | 472427806.547364
 MOROCCO                   |   1993 | 473190782.179159
 MOROCCO                   |   1992 | 475227907.481007
 MOZAMBIQUE                |   1998 | 277153088.622388
 MOZAMBIQUE                |   1997 |  460457308.55707
 MOZAMBIQUE                |   1996 | 463530719.968072
 MOZAMBIQUE                |   1995 |  465596500.24067
 MOZAMBIQUE                |   1994 | 466419497.193496
 MOZAMBIQUE                |   1993 | 465635825.627264
 MOZAMBIQUE                |   1992 | 457207709.285213
 PERU                      |   1998 | 274238773.213452
 PERU                      |   1997 | 467187698.302634
 PERU                      |   1996 | 467228947.508279
 PERU                      |   1995 | 462649270.593581
 PERU                      |   1994 | 465863330.704439
 PERU                      |   1993 | 465025041.546086
 PERU                      |   1992 | 470922327.981292
 ROMANIA                   |   1998 | 275583465.427367
 ROMANIA                   |   1997 | 476852612.340652
 ROMANIA                   |   1996 | 470126722.577523
 ROMANIA                   |   1995 | 470395667.592773
 ROMANIA                   |   1994 | 469530405.205727
 ROMANIA                   |   1993 | 469868836.647629
 ROMANIA                   |   1992 |  474175704.89669
 RUSSIA                    |   1998 | 268369645.119996
 RUSSIA                    |   1997 | 466943495.624119
 RUSSIA                    |   1996 | 475971918.341815
 RUSSIA                    |   1995 | 470394868.361381
 RUSSIA                    |   1994 |  466722005.38715
 RUSSIA                    |   1993 | 471886135.027016
 RUSSIA                    |   1992 | 464979551.510032
 SAUDI ARABIA              |   1998 | 272119221.933966
 SAUDI ARABIA              |   1997 | 473519255.668797
 SAUDI ARABIA              |   1996 | 472188446.414452
 SAUDI ARABIA              |   1995 |   467488160.4049
 SAUDI ARABIA              |   1994 | 467828366.381169
 SAUDI ARABIA              |   1993 | 467146090.068516
 SAUDI ARABIA              |   1992 | 468877144.596128
 UNITED KINGDOM            |   1998 | 262902960.633832
 UNITED KINGDOM            |   1997 |  467457311.79208
 UNITED KINGDOM            |   1996 | 471655709.512833
 UNITED KINGDOM            |   1995 | 462654126.603849
 UNITED KINGDOM            |   1994 | 462353262.565364
 UNITED KINGDOM            |   1993 | 463080136.711742
 UNITED KINGDOM            |   1992 | 467721170.460264
 UNITED STATES             |   1998 | 280722933.077599
 UNITED STATES             |   1997 | 479179059.985258
 UNITED STATES             |   1996 | 469616829.063076
 UNITED STATES             |   1995 | 470091492.419864
 UNITED STATES             |   1994 |  467810655.99809
 UNITED STATES             |   1993 | 471517398.796649
 UNITED STATES             |   1992 | 471306230.617424
 VIETNAM                   |   1998 |  276389368.07091
 VIETNAM                   |   1997 | 466680119.743249
 VIETNAM                   |   1996 | 474293817.181885
 VIETNAM                   |   1995 | 467648214.184579
 VIETNAM                   |   1994 | 468600231.663082
 VIETNAM                   |   1993 | 466036947.784295
 VIETNAM                   |   1992 | 461802240.527222
(175 rows)

COMMIT;
COMMIT
