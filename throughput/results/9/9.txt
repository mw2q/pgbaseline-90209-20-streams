BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%magenta%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 263375681.259487
 ALGERIA                   |   1997 | 460575905.704933
 ALGERIA                   |   1996 | 468218663.628595
 ALGERIA                   |   1995 | 464753915.866963
 ALGERIA                   |   1994 | 460753058.116795
 ALGERIA                   |   1993 | 461692162.300145
 ALGERIA                   |   1992 |  453202360.31124
 ARGENTINA                 |   1998 | 276035084.855122
 ARGENTINA                 |   1997 | 467333229.173788
 ARGENTINA                 |   1996 | 478640035.717393
 ARGENTINA                 |   1995 | 473230554.616804
 ARGENTINA                 |   1994 | 469981679.450973
 ARGENTINA                 |   1993 |  465148870.70628
 ARGENTINA                 |   1992 | 471123568.650957
 BRAZIL                    |   1998 | 272246043.252502
 BRAZIL                    |   1997 | 466907411.394219
 BRAZIL                    |   1996 | 463713384.653415
 BRAZIL                    |   1995 | 464401095.419471
 BRAZIL                    |   1994 |   464969978.9645
 BRAZIL                    |   1993 | 467526277.933006
 BRAZIL                    |   1992 | 465482454.652783
 CANADA                    |   1998 |  275316678.16719
 CANADA                    |   1997 | 475379515.228938
 CANADA                    |   1996 | 476017712.286342
 CANADA                    |   1995 | 481801797.001344
 CANADA                    |   1994 |  479406966.67731
 CANADA                    |   1993 | 473503923.831405
 CANADA                    |   1992 | 473137059.673332
 CHINA                     |   1998 | 274563074.163939
 CHINA                     |   1997 | 461882728.672453
 CHINA                     |   1996 | 467136139.769169
 CHINA                     |   1995 |   455697212.1476
 CHINA                     |   1994 | 458128090.541188
 CHINA                     |   1993 | 464482900.951007
 CHINA                     |   1992 | 468340155.979145
 EGYPT                     |   1998 | 273306826.633774
 EGYPT                     |   1997 | 477940660.033123
 EGYPT                     |   1996 |  471536620.51363
 EGYPT                     |   1995 | 461668691.132477
 EGYPT                     |   1994 | 470163127.069389
 EGYPT                     |   1993 | 462068029.439102
 EGYPT                     |   1992 | 467587592.377647
 ETHIOPIA                  |   1998 | 269553069.456198
 ETHIOPIA                  |   1997 | 454366368.924588
 ETHIOPIA                  |   1996 | 453704819.710803
 ETHIOPIA                  |   1995 | 460065001.762163
 ETHIOPIA                  |   1994 | 454201659.540865
 ETHIOPIA                  |   1993 | 459335739.546306
 ETHIOPIA                  |   1992 | 452150788.701575
 FRANCE                    |   1998 | 271157678.017714
 FRANCE                    |   1997 | 459247798.344892
 FRANCE                    |   1996 | 463810068.558828
 FRANCE                    |   1995 | 467424896.650241
 FRANCE                    |   1994 |  461926273.88223
 FRANCE                    |   1993 | 462201438.641343
 FRANCE                    |   1992 | 453654078.995059
 GERMANY                   |   1998 | 280337459.150976
 GERMANY                   |   1997 | 481686973.235273
 GERMANY                   |   1996 | 478474313.044726
 GERMANY                   |   1995 | 474725744.536003
 GERMANY                   |   1994 | 471552002.650522
 GERMANY                   |   1993 | 480712535.877142
 GERMANY                   |   1992 | 480167388.074147
 INDIA                     |   1998 | 276188563.662699
 INDIA                     |   1997 | 474495666.328316
 INDIA                     |   1996 | 474966432.533224
 INDIA                     |   1995 | 475560322.424101
 INDIA                     |   1994 | 474305324.916142
 INDIA                     |   1993 | 476297977.911812
 INDIA                     |   1992 | 475404900.556814
 INDONESIA                 |   1998 | 268552250.235263
 INDONESIA                 |   1997 | 456600062.681926
 INDONESIA                 |   1996 | 465009371.335986
 INDONESIA                 |   1995 | 461283722.062152
 INDONESIA                 |   1994 | 451010139.115533
 INDONESIA                 |   1993 | 460230473.677893
 INDONESIA                 |   1992 | 460399477.654721
 IRAN                      |   1998 | 266432003.782795
 IRAN                      |   1997 | 464047732.018895
 IRAN                      |   1996 |  464845064.38079
 IRAN                      |   1995 | 458524244.643164
 IRAN                      |   1994 | 467702232.580789
 IRAN                      |   1993 | 468770412.932234
 IRAN                      |   1992 | 456944086.277622
 IRAQ                      |   1998 | 271535897.796944
 IRAQ                      |   1997 | 463930106.735594
 IRAQ                      |   1996 | 460609156.130337
 IRAQ                      |   1995 | 468984031.295467
 IRAQ                      |   1994 |  467236641.45128
 IRAQ                      |   1993 |  465600618.82082
 IRAQ                      |   1992 | 478393233.944187
 JAPAN                     |   1998 | 274192226.744714
 JAPAN                     |   1997 | 469119415.354775
 JAPAN                     |   1996 | 464762423.188709
 JAPAN                     |   1995 | 466553725.119765
 JAPAN                     |   1994 | 475367630.999628
 JAPAN                     |   1993 | 464372306.755819
 JAPAN                     |   1992 | 465248050.340658
 JORDAN                    |   1998 | 265277878.961049
 JORDAN                    |   1997 | 451674822.213899
 JORDAN                    |   1996 | 450327271.903204
 JORDAN                    |   1995 | 455471429.403096
 JORDAN                    |   1994 | 441980316.452829
 JORDAN                    |   1993 | 458407434.583421
 JORDAN                    |   1992 | 447169975.783911
 KENYA                     |   1998 | 273318294.185814
 KENYA                     |   1997 | 463667729.944861
 KENYA                     |   1996 | 466513705.981452
 KENYA                     |   1995 | 464212140.931382
 KENYA                     |   1994 | 465522854.205427
 KENYA                     |   1993 | 465856308.392397
 KENYA                     |   1992 | 467541539.193903
 MOROCCO                   |   1998 | 269389650.048908
 MOROCCO                   |   1997 | 465753837.640424
 MOROCCO                   |   1996 | 473413431.728448
 MOROCCO                   |   1995 | 466828416.546232
 MOROCCO                   |   1994 | 472934947.389731
 MOROCCO                   |   1993 |  466262612.94658
 MOROCCO                   |   1992 | 476101657.954039
 MOZAMBIQUE                |   1998 | 267352663.403495
 MOZAMBIQUE                |   1997 | 465910241.704513
 MOZAMBIQUE                |   1996 | 457032795.736135
 MOZAMBIQUE                |   1995 | 456120583.655448
 MOZAMBIQUE                |   1994 | 459942605.619157
 MOZAMBIQUE                |   1993 | 459721951.885974
 MOZAMBIQUE                |   1992 |  460356635.33176
 PERU                      |   1998 | 271701258.431886
 PERU                      |   1997 |  466841306.33778
 PERU                      |   1996 | 456897102.817725
 PERU                      |   1995 | 461309863.977616
 PERU                      |   1994 | 460329633.837489
 PERU                      |   1993 |  468034672.39375
 PERU                      |   1992 | 466108286.188798
 ROMANIA                   |   1998 | 270132216.998866
 ROMANIA                   |   1997 | 468262300.440378
 ROMANIA                   |   1996 | 476028823.278845
 ROMANIA                   |   1995 |    464363182.474
 ROMANIA                   |   1994 |  470373111.14903
 ROMANIA                   |   1993 | 466145767.154872
 ROMANIA                   |   1992 | 480261908.164438
 RUSSIA                    |   1998 | 278626154.861275
 RUSSIA                    |   1997 | 470257483.519906
 RUSSIA                    |   1996 |    472307116.375
 RUSSIA                    |   1995 | 460815307.716898
 RUSSIA                    |   1994 | 470678035.303508
 RUSSIA                    |   1993 | 467762135.828429
 RUSSIA                    |   1992 | 475404004.004475
 SAUDI ARABIA              |   1998 | 272124436.472727
 SAUDI ARABIA              |   1997 |  470803480.79222
 SAUDI ARABIA              |   1996 | 471788495.743017
 SAUDI ARABIA              |   1995 | 477009448.536886
 SAUDI ARABIA              |   1994 | 463229593.264006
 SAUDI ARABIA              |   1993 | 472392110.949513
 SAUDI ARABIA              |   1992 | 473974509.936684
 UNITED KINGDOM            |   1998 | 264903078.935718
 UNITED KINGDOM            |   1997 |  464726844.78525
 UNITED KINGDOM            |   1996 | 456125480.124463
 UNITED KINGDOM            |   1995 | 454011026.163465
 UNITED KINGDOM            |   1994 | 454265108.677331
 UNITED KINGDOM            |   1993 | 465064041.111352
 UNITED KINGDOM            |   1992 | 463241655.529915
 UNITED STATES             |   1998 | 275738600.603439
 UNITED STATES             |   1997 | 474327657.808232
 UNITED STATES             |   1996 | 472378065.172918
 UNITED STATES             |   1995 | 471928874.864752
 UNITED STATES             |   1994 | 469350516.406829
 UNITED STATES             |   1993 | 472666832.151216
 UNITED STATES             |   1992 | 474104652.824495
 VIETNAM                   |   1998 | 274932199.074595
 VIETNAM                   |   1997 | 463756407.608084
 VIETNAM                   |   1996 | 466235057.352609
 VIETNAM                   |   1995 | 468322259.212734
 VIETNAM                   |   1994 | 466583531.852461
 VIETNAM                   |   1993 |  469398151.65752
 VIETNAM                   |   1992 | 469636695.310609
(175 rows)

COMMIT;
COMMIT
