BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%azure%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271779046.721346
 ALGERIA                   |   1997 | 457411486.222054
 ALGERIA                   |   1996 |  459197711.80841
 ALGERIA                   |   1995 | 462542019.094784
 ALGERIA                   |   1994 | 464948029.886443
 ALGERIA                   |   1993 | 459365406.770185
 ALGERIA                   |   1992 | 466572820.207948
 ARGENTINA                 |   1998 | 283791730.595078
 ARGENTINA                 |   1997 | 478122739.540268
 ARGENTINA                 |   1996 |  482687835.72792
 ARGENTINA                 |   1995 |   472448641.2847
 ARGENTINA                 |   1994 | 474194862.593274
 ARGENTINA                 |   1993 | 467643982.941691
 ARGENTINA                 |   1992 | 476946444.814131
 BRAZIL                    |   1998 |  272150347.40349
 BRAZIL                    |   1997 | 474864637.178037
 BRAZIL                    |   1996 | 476349181.318397
 BRAZIL                    |   1995 |  465295352.77616
 BRAZIL                    |   1994 | 465793678.929202
 BRAZIL                    |   1993 | 474817578.065769
 BRAZIL                    |   1992 | 474143944.370843
 CANADA                    |   1998 | 281391154.070655
 CANADA                    |   1997 | 474090494.658595
 CANADA                    |   1996 | 477114979.953929
 CANADA                    |   1995 | 481390344.345673
 CANADA                    |   1994 | 485546205.932844
 CANADA                    |   1993 | 475543474.693307
 CANADA                    |   1992 |  481679826.69192
 CHINA                     |   1998 | 277309079.015213
 CHINA                     |   1997 | 468911218.848774
 CHINA                     |   1996 | 473811304.015955
 CHINA                     |   1995 | 469540803.254381
 CHINA                     |   1994 |  460511794.80821
 CHINA                     |   1993 | 471651480.879408
 CHINA                     |   1992 | 475088767.058581
 EGYPT                     |   1998 | 264414734.181655
 EGYPT                     |   1997 | 460471143.599904
 EGYPT                     |   1996 | 460521759.485352
 EGYPT                     |   1995 | 459675647.791517
 EGYPT                     |   1994 | 464951098.150901
 EGYPT                     |   1993 | 460676293.442901
 EGYPT                     |   1992 |  455148687.52589
 ETHIOPIA                  |   1998 | 281834661.406969
 ETHIOPIA                  |   1997 | 459767438.526091
 ETHIOPIA                  |   1996 | 462212795.175428
 ETHIOPIA                  |   1995 | 468504949.942861
 ETHIOPIA                  |   1994 | 466334690.265338
 ETHIOPIA                  |   1993 | 470620964.857805
 ETHIOPIA                  |   1992 | 459139795.341398
 FRANCE                    |   1998 | 271592483.151255
 FRANCE                    |   1997 | 467993585.799184
 FRANCE                    |   1996 | 467027599.180264
 FRANCE                    |   1995 | 461337395.025044
 FRANCE                    |   1994 | 463244100.244864
 FRANCE                    |   1993 | 462632041.162001
 FRANCE                    |   1992 |  466623324.90847
 GERMANY                   |   1998 | 279451117.988516
 GERMANY                   |   1997 | 478300600.967763
 GERMANY                   |   1996 | 475254074.163943
 GERMANY                   |   1995 | 481897362.279639
 GERMANY                   |   1994 | 482539070.857974
 GERMANY                   |   1993 | 480190002.838596
 GERMANY                   |   1992 | 471497049.336563
 INDIA                     |   1998 | 272644389.043334
 INDIA                     |   1997 | 467731136.259246
 INDIA                     |   1996 | 480630498.556379
 INDIA                     |   1995 | 473248312.300666
 INDIA                     |   1994 | 474245983.580473
 INDIA                     |   1993 |  469198213.82873
 INDIA                     |   1992 | 472501748.342174
 INDONESIA                 |   1998 | 269803789.444834
 INDONESIA                 |   1997 | 459629781.182649
 INDONESIA                 |   1996 | 470595267.028366
 INDONESIA                 |   1995 | 458478621.375826
 INDONESIA                 |   1994 | 451200429.834837
 INDONESIA                 |   1993 | 464489139.436929
 INDONESIA                 |   1992 | 457573296.845083
 IRAN                      |   1998 | 273533518.820586
 IRAN                      |   1997 | 463104936.654006
 IRAN                      |   1996 | 464647360.390917
 IRAN                      |   1995 |    473056626.977
 IRAN                      |   1994 | 466805503.290151
 IRAN                      |   1993 | 463503063.638537
 IRAN                      |   1992 | 457804235.556045
 IRAQ                      |   1998 | 274413837.079365
 IRAQ                      |   1997 | 458853537.107173
 IRAQ                      |   1996 | 468360210.051169
 IRAQ                      |   1995 | 465592938.774237
 IRAQ                      |   1994 | 465405748.230048
 IRAQ                      |   1993 | 466557775.540758
 IRAQ                      |   1992 | 474511619.373717
 JAPAN                     |   1998 | 274374306.555138
 JAPAN                     |   1997 | 471370290.179229
 JAPAN                     |   1996 | 468450339.213571
 JAPAN                     |   1995 | 465223886.881895
 JAPAN                     |   1994 | 472059290.312819
 JAPAN                     |   1993 | 471974832.109005
 JAPAN                     |   1992 | 462449890.542829
 JORDAN                    |   1998 |  268751098.71553
 JORDAN                    |   1997 | 466003799.559127
 JORDAN                    |   1996 | 464975231.918701
 JORDAN                    |   1995 | 460969438.101089
 JORDAN                    |   1994 | 466571223.956235
 JORDAN                    |   1993 | 462092201.363898
 JORDAN                    |   1992 | 462526477.739726
 KENYA                     |   1998 | 277611341.182871
 KENYA                     |   1997 | 473538922.769876
 KENYA                     |   1996 | 472449343.733068
 KENYA                     |   1995 | 473163247.181312
 KENYA                     |   1994 |   470610823.3679
 KENYA                     |   1993 | 471843845.236816
 KENYA                     |   1992 | 473690206.987908
 MOROCCO                   |   1998 | 276384739.214078
 MOROCCO                   |   1997 | 473505426.823421
 MOROCCO                   |   1996 | 472447367.234962
 MOROCCO                   |   1995 | 478082841.138586
 MOROCCO                   |   1994 | 466408330.410549
 MOROCCO                   |   1993 | 472974891.164126
 MOROCCO                   |   1992 | 477557737.270382
 MOZAMBIQUE                |   1998 | 277014527.009469
 MOZAMBIQUE                |   1997 | 464282488.342018
 MOZAMBIQUE                |   1996 | 464152763.358561
 MOZAMBIQUE                |   1995 | 463690906.137426
 MOZAMBIQUE                |   1994 | 464240594.133393
 MOZAMBIQUE                |   1993 | 471292340.726005
 MOZAMBIQUE                |   1992 | 464614390.609527
 PERU                      |   1998 |  274861567.08567
 PERU                      |   1997 | 465958474.321475
 PERU                      |   1996 | 470141070.721706
 PERU                      |   1995 | 456394706.959461
 PERU                      |   1994 | 467363306.790481
 PERU                      |   1993 | 460220064.339633
 PERU                      |   1992 | 462880541.777846
 ROMANIA                   |   1998 | 273378573.505758
 ROMANIA                   |   1997 | 468042667.680928
 ROMANIA                   |   1996 |  471224735.27481
 ROMANIA                   |   1995 | 469274252.817443
 ROMANIA                   |   1994 | 456337163.859985
 ROMANIA                   |   1993 | 457976485.781162
 ROMANIA                   |   1992 | 473772289.828712
 RUSSIA                    |   1998 | 272327321.483299
 RUSSIA                    |   1997 | 468646362.672776
 RUSSIA                    |   1996 | 460035895.987208
 RUSSIA                    |   1995 |  468477181.67572
 RUSSIA                    |   1994 | 468617318.501309
 RUSSIA                    |   1993 | 466747581.672728
 RUSSIA                    |   1992 | 469296168.767433
 SAUDI ARABIA              |   1998 | 275146685.121611
 SAUDI ARABIA              |   1997 | 476258321.098896
 SAUDI ARABIA              |   1996 | 472496425.821525
 SAUDI ARABIA              |   1995 | 468792331.562563
 SAUDI ARABIA              |   1994 | 467002658.275895
 SAUDI ARABIA              |   1993 | 476472315.073994
 SAUDI ARABIA              |   1992 | 477602049.989194
 UNITED KINGDOM            |   1998 | 274263103.577782
 UNITED KINGDOM            |   1997 | 465806919.540249
 UNITED KINGDOM            |   1996 | 461949689.672316
 UNITED KINGDOM            |   1995 |   461650079.2891
 UNITED KINGDOM            |   1994 | 461521784.097663
 UNITED KINGDOM            |   1993 |  467135373.99491
 UNITED KINGDOM            |   1992 | 461519063.810854
 UNITED STATES             |   1998 | 271502758.559433
 UNITED STATES             |   1997 |  475698294.19987
 UNITED STATES             |   1996 | 482244014.396642
 UNITED STATES             |   1995 |  478715549.01186
 UNITED STATES             |   1994 | 475907959.547945
 UNITED STATES             |   1993 | 468641796.022693
 UNITED STATES             |   1992 | 474683671.950065
 VIETNAM                   |   1998 | 271977768.502204
 VIETNAM                   |   1997 |  458941439.17796
 VIETNAM                   |   1996 | 474483704.034341
 VIETNAM                   |   1995 | 459770494.148549
 VIETNAM                   |   1994 | 467320467.975481
 VIETNAM                   |   1993 | 463385923.101643
 VIETNAM                   |   1992 | 463293447.576698
(175 rows)

COMMIT;
COMMIT
